# Artagon Bazel Configuration for C Projects

# Build settings
build --enable_platform_specific_config
build --incompatible_strict_action_env
build --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1

# C Standard
build --copt=-std=c17
build --conlyopt=-std=c17

# Compilation flags
build --copt=-Wall
build --copt=-Wextra
build --copt=-Wpedantic
build --copt=-Werror

# Optimization for release
build:release --compilation_mode=opt
build:release --copt=-O3
build:release --copt=-DNDEBUG
build:release --strip=always

# Debug configuration
build:debug --compilation_mode=dbg
build:debug --copt=-g
build:debug --copt=-O0
build:debug --strip=never

# Sanitizers
build:asan --copt=-fsanitize=address
build:asan --linkopt=-fsanitize=address
build:asan --copt=-fno-omit-frame-pointer

build:ubsan --copt=-fsanitize=undefined
build:ubsan --linkopt=-fsanitize=undefined

build:tsan --copt=-fsanitize=thread
build:tsan --linkopt=-fsanitize=thread

# Coverage
build:coverage --combined_report=lcov
build:coverage --instrumentation_filter="//..."
build:coverage --collect_code_coverage

# Test configuration
test --test_output=errors
test --test_verbose_timeout_warnings

# Platform-specific configurations
build:linux --cxxopt=-std=c++17
build:macos --cxxopt=-std=c++17
build:windows --cxxopt=/std:c++17

# Try to use hermetic C++ toolchain
build --incompatible_enable_cc_toolchain_resolution

# Remote cache (if available)
# build --remote_cache=grpc://your-cache-server:port

# Disk cache
build --disk_cache=~/.cache/bazel

# Show detailed errors
build --verbose_failures

# Color output
common --color=yes

# Keep going after errors
build --keep_going
