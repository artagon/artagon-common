{
  "migration_id": "agents-refactor-20251020",
  "timestamp": "2025-10-20T06:33:00Z",
  "description": "Refactor agent directories to eliminate duplication between Claude and Codex",
  "changes": {
    "directories_created": [
      ".agents-shared/",
      ".agents-claude/",
      ".agents-codex/"
    ],
    "symlinks_created": [
      {
        "link": ".claude",
        "target": ".agents-claude",
        "purpose": "Claude Code model alias"
      },
      {
        "link": ".codex",
        "target": ".agents-codex",
        "purpose": "Codex model alias"
      },
      {
        "link": ".agents",
        "target": ".agents-codex",
        "purpose": "Backward compatibility for Codex"
      },
      {
        "link": ".agents-claude/preferences.md",
        "target": "../.agents-shared/preferences.md",
        "purpose": "Shared preferences"
      },
      {
        "link": ".agents-claude/project-context.md",
        "target": "../.agents-shared/project-context.md",
        "purpose": "Shared project context"
      },
      {
        "link": ".agents-codex/preferences.md",
        "target": "../.agents-shared/preferences.md",
        "purpose": "Shared preferences"
      },
      {
        "link": ".agents-codex/project-context.md",
        "target": "../.agents-shared/project-context.md",
        "purpose": "Shared project context"
      }
    ],
    "files_created": [
      {
        "path": ".agents-shared/preferences.md",
        "source": "Merged from .agents/claude/preferences.md and .agents/codex/preferences.md",
        "checksum_claude": "e511683e76934deee163f04f7628e444",
        "checksum_codex": "ab4efa060742f045c274eae9f43be742"
      },
      {
        "path": ".agents-shared/project-context.md",
        "source": "Copied from .agents/codex/project-context.md",
        "checksum": "ff177be712acf5e12405d4e09faa9a18"
      },
      {
        "path": ".agents-claude/project.md",
        "source": "New model-specific configuration for Claude"
      },
      {
        "path": ".agents-codex/project.md",
        "source": "New model-specific configuration for Codex"
      }
    ],
    "directories_renamed": [
      {
        "from": ".agents/",
        "to": ".agents-old/",
        "note": "Original directory preserved for reference"
      }
    ],
    "duplicates_resolved": [
      {
        "file": "preferences.md",
        "locations": [
          ".agents/claude/preferences.md",
          ".agents/codex/preferences.md"
        ],
        "resolution": "Merged into .agents-shared/preferences.md with model_overrides section",
        "similarity": "~80% content overlap",
        "differences": "Claude version more verbose, Codex more concise. Merged to create comprehensive shared version."
      },
      {
        "file": "project-context.md",
        "locations": [
          ".agents/codex/project-context.md"
        ],
        "resolution": "Copied to .agents-shared/project-context.md (Claude didn't have this file)",
        "note": "Claude will now benefit from this shared context"
      }
    ]
  },
  "verification": {
    "symlinks_valid": true,
    "no_broken_links": true,
    "backward_compatible": true
  },
  "rollback_instructions": {
    "steps": [
      "1. Extract backup: tar -xzf tools/migrations/agents-backup-20251020-062846.tar.gz",
      "2. Remove new directories: rm -rf .agents-shared .agents-claude .agents-codex",
      "3. Remove symlinks: rm .claude .codex .agents",
      "4. Restore original: mv .agents-old .agents"
    ]
  }
}
